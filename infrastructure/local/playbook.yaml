---
- name: Deploy multi-container application with Docker Compose
  hosts: web
  become: yes # Use sudo to run Docker command

  tasks:
    - name: Create application directory on remote host
      ansible.builtin.file:
        path: /opt/my_app
        state: directory
        mode: '0755'

    - name: Copy docker-compose.yml and application files to remote host
      ansible.builtin.copy:
        src: my_app/
        dest: /opt/
      # The `my_app` directory on the control node contains
      # the docker-compose.yml and the html directory.

    - name: Ensure Docker Compose services are running and up-to-date
      community.docker.docker_compose_v2:
        project_src: /opt/my_app # Directory containing docker-compose.yml
        state: present          # Ensures the services are created and running
        pull: true              # Pulls latest images before starting
        build: false            # Set to true if you need to build images
      register: compose_output

    - name: Display Docker Compose result
      ansible.builtin.debug:
        var: compose_output